# React Reconciler

`Reconciler` 的工作流程总的来说就是对 `Fiber` 树进行一次 **深度优先遍历（DFS）**，首先访问根节点，然后依次访问左子树和右子树，通过比较新节点（新生成的 `React Element`）和旧节点（现有的 `FiberNode`），生成更新计划，并打上不同的标记。

1. **遍历 Fiber 树**：React 使用深度优先搜索（DFS）算法来遍历 Fiber 树，首先会从 Fiber 树的根节点开始进行遍历，遍历整个组件树的结构。
2. **比较新旧节点**：对于每个 Fiber 节点，`Reconciler` 会比较新节点（即新的 `React Element`）和旧节点（即现有的 `FiberNode`）之间的差异，比较的内容包括节点类型、属性、子节点等方面的差异。
3. **生成更新计划**：根据比较的结果，`Reconciler` 会生成一个更新计划。*用于确定需要进行的操作，更新计划通常包括哪些节点需要更新、哪些节点需要插入到 DOM 中、哪些节点需要删除等信息。*
4. **打标记（Tagging）**：为了记录不同节点的操作，React 会为每个节点打上不同的标记。*例如，如果节点需要更新，可能会打上更新标记（Update Tag）；如果节点是新创建的，可能会打上插入标记（Placement Tag）；如果节点被移除，可能会打上删除标记（Deleting Tag）等。*
5. **更新 Fiber 节点**：根据生成的更新计划和标记，`Reconciler` 会更新对应的 Fiber 节点以反映组件的最新状态。*更新操作可能包括更新节点的状态、更新节点的属性、调用生命周期方法等。*
6. **递归处理子节点**：对于每个节点的子节点，React 会递归地重复进行上述的比较和更新操作，以确保整个组件树都得到正确的处理。

当所有 `React Element` 都比较完成之后，会生成一颗新的 Fiber 树，此时，一共存在两颗 Fiber 树：

- **current**：与视图中真实 UI 对应的 Fiber 树，当 React 开始新的一轮渲染时，会使用 `current` 作为参考来比较新的树与旧树的差异，决定如何更新 UI；
- **workInProgress**：触发更新后，正在 Reconciler 中计算的 Fiber 树，一旦 `workInProgress` 上的更新完成，它将会被提交为新的 `current`，成为下一次渲染的参考树，并清空旧的 `current` 树。
